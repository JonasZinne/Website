{% extends 'base.html' %}

{% block title %}Export Vetos{% endblock %}

{% block content %}
    <section class="section">
        <h2>Vetos exportieren</h2>
        
        <form method="POST" action="{{ url_for('export_vetos') }}">
            <table>
                <!-- Team A und B Auswahl -->
                {% for team_label, team_name in [('Team A', 'team_a'), ('Team B', 'team_b')] %}
                    <tr>
                        <td><label for="{{ team_name }}">{{ team_label }}:</label></td>
                        <td>
                            <select name="{{ team_name }}" required>
                                <option value="" disabled selected hidden>Bitte wählen</option>
                                {% for team in teams %}
                                    <option value="{{ team }}">{{ team }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                {% endfor %}

                 <!-- Ban/Pick mit Seitenwahl -->
                {% for label, name, side_name in [('A ban', 'ban_a1', None), 
                                                  ('B ban', 'ban_b1', None), 
                                                  ('A pick', 'pick_a', 'side_b1'), 
                                                  ('B pick', 'pick_b', 'side_a1'), 
                                                  ('A ban', 'ban_a2', None), 
                                                  ('B ban', 'ban_b2', None)] %}
                    <tr>
                        <td><label for="{{ name }}">{{ label }}:</label></td>
                        <td>
                            <select name="{{ name }}" class="map-select" required>
                                <option value="" disabled selected hidden>Bitte wählen</option>
                                {% for map in maps %}
                                    <option value="{{ map }}">{{ map }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>

                    {% if side_name %}
                        <tr>
                            <td><label for="{{ side_name }}">Seitenwahl (Att/Def):</label></td>
                            <td>
                                <select name="{{ side_name }}">
                                    <option value="" disabled selected hidden>Bitte wählen</option>
                                    <option value="att">Att</option>
                                    <option value="def">Def</option>
                                </select>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}

                <!-- Decider -->
                <tr>
                    <td><label for="side_a2">A Start (Decider):</label></td>
                    <td>
                        <select name="side_a2">
                            <option value="" disabled selected hidden>Bitte wählen</option>
                            <option value="att">Att</option>
                            <option value="def">Def</option>
                        </select>
                    </td>
                </tr>
            </table>
        
            <button type="submit">Veto exportieren</button>   
        </form>
    </section>

    {% if veto_result %}
        <section class="section">
            <h2>Ergebnis</h3>
            
            <p>{{ veto_result.team_a }} (A) - {{ veto_result.team_b }} (B)</p>
            <table>
                <tr><td>A ban</td><td>{{ veto_result.bans.A[0] }}</td></tr>
                <tr><td>B ban</td><td>{{ veto_result.bans.B[0] }}</td></tr>
                <tr><td>A pick</td><td>{{ veto_result.picks.A }}</td></tr>
                <tr><td>B start</td><td>{{ veto_result.sides.pick_a }}</td></tr>
                <tr><td>B pick</td><td>{{ veto_result.picks.B }}</td></tr>
                <tr><td>A start</td><td>{{ veto_result.sides.pick_b }}</td></tr>
                <tr><td>A ban</td><td>{{ veto_result.bans.A[1] }}</td></tr>
                <tr><td>B ban</td><td>{{ veto_result.bans.B[1] }}</td></tr>
                <tr><td>A start</td><td>{{ veto_result.sides.decider }} ({{ veto_result.decider }})</td></tr>
            </table>
        </section>
    {% endif %}

    <section class="section">
        <a href="{{ url_for('index') }}" class="button">Zurück zur Startseite</a>
    </section>

    <!-- JavaScript zur Verwaltung der Dropdown-Optionen -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mapSelects = document.querySelectorAll('.map-select');

            function updateSelectOptions() {
                const selectedMaps = Array.from(mapSelects)
                    .map(select => select.value)
                    .filter(value => value);
    
                mapSelects.forEach(select => {
                    const currentValue = select.value;
                    Array.from(select.options).forEach(option => {
                        option.disabled = selectedMaps.includes(option.value) && option.value !== currentValue;
                    });
                });
            }
    
            mapSelects.forEach(select => {
                select.addEventListener('change', updateSelectOptions);
            });
    
            updateSelectOptions();
        });
    </script>    
{% endblock %}